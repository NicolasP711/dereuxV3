{% extends 'base.html.twig' %}

{% block title %}{{article.title}}{% endblock %}

{% block body %}
  {% include 'partials/flashes/error.html.twig' %}
  {% include 'partials/flashes/success.html.twig' %}

    <article>
            <h1 class="blogArticle my-4 col-12"><b>{{article.title|striptags|slice(0, 100)}}</b></h1>
            <div class="blogArticle mb-4 col-12">{{ article.content|purify }}</div>
            <p>Publié le <b>{{ article.publicationDate ? article.publicationDate|date('Y-m-d à H:i:s') : '' }}</b> par <b>{{ article.author.pseudonym }}</b></p>

    </article>


    <div id="profilBtn" class="mt-5">
        {% if is_granted("ROLE_ADMIN") %}
            <a class="btn btn-warning mb-5" href="{{ path('blog_admin') }}">Gestion du blog</a>
            <a class="btn defaultBtn mb-5" href="{{ path('blog_index') }}">Retour aux articles</a>
            <a class="btn btn-primary mb-5" href="{{ path('blog_edit', {'slug': article.slug}) }}">Éditer</a>
            {{ include('blog/_delete_form.html.twig') }}
        {% else %}
            <a class="btn defaultBtn" href="{{ path('blog_index') }}">Retour aux articles</a>
        {% endif %}
    </div>

    
    {% if article.ArticleComments is empty %}
      <p class="text-center alert alert-warning my-2">Aucun commentaire n'a été publié pour le moment.</p>
    {% else %}
      <p class="text-center my-4">Commentaires: {{ article.ArticleComments|length }}</p>
      {% for comment in article.Articlecomments %}
      <div class="comment my-4 text-justify float-left">

        {% if comment.author.photo is null %}
            <img class="rounded-circle me-1" width="40" height="40" src="{{ asset('img/profil_default.png')|imagine_filter('profil') }}" alt="image de profil">
        {% else %}
            <img class="rounded-circle me-1" width="40" height="40" src="{{ asset('img/users/' ~ comment.author.photo)|imagine_filter('profil') }}" alt="image de profil">
        {% endif %}

        <h4><strong>{{ comment.author.pseudonym }}</strong></h4> <span>- {{ comment.publicationDate|date('d/m/Y à H\\hi') }}</span>
        <p class="mt-2" id="commentContent">{{ comment.content|purify }}</p>

          {% if is_granted('ROLE_ADMIN') or app.user.id is defined and comment.author.id == app.user.id %}
              <a class="btn btn-danger" href="{{ path('delete_article_comment', {'slug': comment.slug, csrf_token: csrf_token('delete_article_comment_' ~ comment.id)}) }}"><i class="text-white fas fa-trash me-1"></i>Supprimer</a>
          {% endif %}




          
          {% if is_granted('ROLE_USER') and app.user.id is defined and comment.author.id == app.user.id %}
              <a class="btn altBtn" href="{{ path('comment_edit', {'slug': comment.slug}) }}"><i class="fas fa-edit me-1"></i>Modifier</a>
          {% endif %}
          <hr>


      </div>
      {% endfor %}
    {% endif %}

    <div>
      {# Liste des commentaires lié à l'article #}
      {% if is_granted('ROLE_USER') %}
          <h2 class="h3 text-center my-5">Ajouter un commentaire :</h2>
          {{ form(form) }}
      {% else %}
        <button type="button" class="btn btn-primary ms-auto me-auto my-4"><a href="{{ path('app_login') }}" style="color: white;">Connectez vous pour ajouter un commentaire</a></button>
      {% endif %}
    </div>

{% endblock %}
